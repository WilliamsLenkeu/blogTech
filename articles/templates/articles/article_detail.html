{% extends 'base.html' %}
{% block content %}
<div class="container my-4">
    <h1>{{ article.title }}</h1>
    <p>Par {{ article.author }} | {{ article.created_at|date:"d M Y" }} | {{ article.category }} | {{ article.likes.count }} Like{{ article.likes.count|pluralize }}</p>
    {% if article.image %}
        <img src="{{ article.image.url }}" class="img-fluid mb-3" alt="{{ article.title }}" style="max-height: 400px; object-fit: cover;">
    {% endif %}
    <div>{{ article.content|safe }}</div>
    
    <!-- Bouton Like -->
    {% if user.is_authenticated %}
        <form method="post" action="{% url 'article_like' article.slug %}">
            {% csrf_token %}
            <button type="submit" class="btn {% if is_liked %}btn-outline-primary{% else %}btn-primary{% endif %}">
                {% if is_liked %}Retirer le like{% else %}Liker{% endif %}
            </button>
        </form>
    {% else %}
        <p><a href="{% url 'login' %}">Connectez-vous</a> pour liker cet article.</p>
    {% endif %}
    
    {% if user.is_authenticated and user == article.author or user.is_staff %}
        <a href="{% url 'article_edit' article.slug %}" class="btn btn-warning">Modifier</a>
        <a href="{% url 'article_delete' article.slug %}" class="btn btn-danger">Supprimer</a>
    {% endif %}

    <h2 class="mt-5">Commentaires</h2>
    {% for comment in comments %}
        <div class="card mb-2">
            <div class="card-body">
                <p class="card-text">{{ comment.content }}</p>
                <p class="card-text"><small>Par {{ comment.author }} | {{ comment.created_at|date:"d M Y H:i" }}</small></p>
                {% if user.is_authenticated and user == comment.author or user == article.author or user.is_staff %}
                    <a href="{% url 'comment_delete' article.slug comment.id %}" class="btn btn-danger btn-sm">Supprimer</a>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <p>Aucun commentaire pour le moment.</p>
    {% endfor %}

    {% if user.is_authenticated %}
        <h3>Ajouter un commentaire</h3>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Commenter</button>
        </form>
    {% else %}
        <p><a href="{% url 'login' %}">Connectez-vous</a> pour ajouter un commentaire.</p>
    {% endif %}
</div>
{% endblock %}